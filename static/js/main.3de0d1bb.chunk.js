(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{104:function(e,t,n){},110:function(e,t){},112:function(e,t){},144:function(e,t){},145:function(e,t){},192:function(e,t,n){},193:function(e,t,n){},194:function(e,t,n){"use strict";n.r(t);var a=n(6),r=n.n(a),c=n(96),o=n.n(c),i=(n(104),n(13)),s=n.n(i),l=n(31),u=n(17),d=n(15),m=n(97),h=n(19),p=n(18),f=n(20),b=n(98),w=n.n(b),v=n(32),g=n(22),j=function e(t){var n=this;Object(d.a)(this,e),this.loadModel=function(){return g.c(n.modelPath).then(function(e){n.model=e,console.log("Loaded model with shape: ".concat(e.input.shape))}).catch(console.log)},this.modelPath=t},O=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/face_detector"))).loadModel=function(){return v.d.tinyFaceDetector.load(e.modelPath)},e.detectFace=function(e){return v.b(e,new v.a).then(function(t){return v.c(e,t)})},e}return Object(f.a)(t,e),t}(j),y=function(e,t){var n=g.a.fromPixels(e),a=Object(l.a)(n.shape,2),r=a[0],c=a[1];return r===t&&c===t?n:g.b.resizeBilinear(n,[t,t],!0)},E=function(){var e=Object(u.a)(s.a.mark(function e(t){var n,a,r,c,o,i,u,d,m;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.min(),a=t.max(),e.next=4,Promise.all([n.data(),a.data()]);case 4:return r=e.sent,c=r.map(function(e){return e[0]}),o=Object(l.a)(c,2),i=o[0],u=o[1],n.dispose(),a.dispose(),d=t.sub(g.d(i)).div(g.d(u-i)),m=d.mean(2),e.abrupt("return",m.expandDims(2));case 11:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),k=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/emotion/model.json"))).emotions={0:"Angry",1:"Disgusted",2:"Fearful",3:"Happy",4:"Sad",5:"Surprised",6:"Neutral"},e.predict=function(){var t=Object(u.a)(s.a.mark(function t(n){var a,r,c,o,i,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=y(n,48),t.next=3,E(a);case 3:return r=t.sent,c=r.reshape([1,48,48,1]),o=e.model.predict(c),t.next=8,o.data();case 8:return i=t.sent,l=[],i.forEach(function(t,n){return l.push({label:e.emotions[n],value:t})}),t.abrupt("return",l);case 12:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e}return Object(f.a)(t,e),t}(j),x=function(e){function t(){var e;return Object(d.a)(this,t),(e=Object(h.a)(this,Object(p.a)(t).call(this,"https://s3.amazonaws.com/intenseye-workshop/age_gender2/model.json"))).predict=function(){var t=Object(u.a)(s.a.mark(function t(n){var a,r,c,o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=y(n,64),t.next=3,E(a);case 3:return r=t.sent,c=r.reshape([1,64,64,1]),o=e.model.predict(c),t.abrupt("return",o.data());case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),e}return Object(f.a)(t,e),t}(j),D=(n(192),n(193),function(e){var t=e.label,n=e.value;return r.a.createElement("div",{className:"result"},r.a.createElement("span",{className:"result__label"},t),r.a.createElement("div",{style:{width:n>.01?150*n:0},className:"result__value"}))}),A=function(e){function t(){var e,n;Object(d.a)(this,t);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(n=Object(h.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(c)))).faceDetector=new O,n.emotionDetector=new k,n.ageGenderDetector=new x,n.webcam=r.a.createRef(),n.canvas=r.a.createRef(),n.state={emotionPredictions:[],gender:null,modelsLoaded:!1,webcamAllowed:null},n.delay=function(e){return new Promise(function(t){return setTimeout(t,e)})},n.connectToWebcam=function(){if(navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia({video:!0}).then(function(e){n.webcam.current.srcObject=e,n.setState({webcamAllowed:!0})}).catch(function(e){throw console.log(e),n.setState({webcamAllowed:!1}),new Error("webc")})},n.detectFace=Object(u.a)(s.a.mark(function e(){var t,a,r,c,o,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.faceDetector.detectFace(n.webcam.current);case 3:if(!((t=e.sent).length>0)){e.next=19;break}return e.next=7,n.emotionDetector.predict(t[0]);case 7:return a=e.sent,e.next=10,n.ageGenderDetector.predict(t[0]);case 10:if(r=e.sent,c=Object(l.a)(r,1),o=c[0],null!=a&&n.setState({emotionPredictions:a}),null==o){e.next=19;break}if(!(o>.4&&o<.6)){e.next=17;break}return e.abrupt("return",n.detectFace());case 17:i=o<.5?"Male":"Female",n.setState({gender:i});case 19:return e.abrupt("return",n.detectFace());case 22:return e.prev=22,e.t0=e.catch(0),console.log(e.t0),e.abrupt("return",null);case 26:case"end":return e.stop()}},e,null,[[0,22]])})),n.renderApp=function(e){return n.state.webcamAllowed?r.a.createElement("div",{className:"result-wrapper"},n.state.gender&&r.a.createElement("div",null,r.a.createElement("span",null,"Gender: "),r.a.createElement("span",{style:{color:e}},n.state.gender)),n.state.emotionPredictions.map(function(e){var t=e.label,n=e.value;return r.a.createElement(D,{key:t,label:t,value:n})})):null},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;Promise.all([this.faceDetector.loadModel(),this.emotionDetector.loadModel(),this.ageGenderDetector.loadModel()]).then(function(){return e.setState({modelsLoaded:!0})}).then(this.connectToWebcam).then(function(){return e.delay(1e3)}).then(w.a.throttle(this.detectFace,50)).catch(console.log)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"render",value:function(){var e="Male"===this.state.gender?"#00a8ff":"#e056fd";return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:"App-container"},!1===this.state.webcamAllowed&&r.a.createElement("h4",{style:{color:"#EA2027"}},"To run this application you need to allow webcam access"),r.a.createElement("h2",{style:{color:"orange"}},"Emotion & Gender prediction demo"),r.a.createElement("div",{id:"container"},this.state.modelsLoaded?r.a.createElement("video",{autoPlay:!0,width:640,height:480,ref:this.webcam,id:"videoElement"}):r.a.createElement("span",null,"Downloading models..."),this.renderApp(e))))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(A,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},99:function(e,t,n){e.exports=n(194)}},[[99,1,2]]]);
//# sourceMappingURL=main.3de0d1bb.chunk.js.map